<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carnets - Congreso HeLa 2026</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      width: 100%;
      max-width: 960px;
      min-height: 100vh;
      margin: 0 auto;
      padding: 0 1rem 2rem;
      color: #1a1a1a;
      background: #f5f6f8;
    }
    .page { display: none; }
    .page.active { display: block; }

    /* Header HeLa */
    .hela-header {
      background: linear-gradient(135deg, #a8d4e8 0%, #c5e3f0 100%);
      padding: 1.5rem 1rem;
      margin: 0 -1rem 2rem;
      border-radius: 0 0 12px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .hela-header .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .hela-header .gear {
      width: 48px;
      height: 48px;
      background: rgba(255,255,255,0.6);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
    }
    .hela-header .brand { font-size: 1.5rem; font-weight: 700; color: #1a4d6d; }
    .hela-header .year { font-size: 1.75rem; font-weight: 800; color: #1a4d6d; }

    /* Landing */
    .intro {
      background: #fff;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,.08);
      margin-bottom: 1.5rem;
    }
    .intro h1 { margin: 0 0 1rem; font-size: 1.5rem; color: #1a4d6d; }
    .intro p { margin: 0 0 0.75rem; line-height: 1.6; color: #444; }
    .intro .note {
      background: #f0f9e8;
      border-left: 4px solid #7cb342;
      padding: 0.75rem 1rem;
      margin-top: 1rem;
      font-size: 0.9rem;
      color: #333;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      background: #1a4d6d;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
    }
    .btn:hover { background: #153a52; }

    /* Form */
    .form-card {
      background: #fff;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,.08);
    }
    .back-link {
      display: inline-block;
      margin-bottom: 1rem;
      color: #1a4d6d;
      text-decoration: none;
      font-size: 0.9rem;
    }
    .back-link:hover { text-decoration: underline; }
    .section-title {
      color: #2e7d32;
      font-size: 1.1rem;
      font-weight: 700;
      margin: 1.5rem 0 0.75rem;
    }
    .section-title:first-child { margin-top: 0; }
    .field {
      margin-bottom: 1.25rem;
    }
    .field label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.35rem;
      color: #333;
    }
    .field label .req { color: #c62828; }
    .field .hint {
      display: flex;
      align-items: flex-start;
      gap: 0.35rem;
      font-size: 0.85rem;
      color: #555;
      margin-bottom: 0.35rem;
    }
    .field .hint .info-icon { color: #1976d2; }
    .field input[type="text"],
    .field input[type="email"],
    .field input[type="tel"],
    .field input[type="password"],
    .field select {
      width: 100%;
      padding: 0.6rem 0.75rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
    }
    .field input:focus, .field select:focus {
      outline: none;
      border-color: #1a4d6d;
      box-shadow: 0 0 0 2px rgba(26,77,109,.15);
    }
    .field.error input, .field.error select { border-color: #c62828; }
    .field .error-msg { font-size: 0.85rem; color: #c62828; margin-top: 0.25rem; }
    .validacion-mensaje { font-size: 0.95rem; margin-top: 0.35rem; min-height: 1.4em; }
    .validacion-mensaje.correcta { color: #2e7d32; font-weight: 600; }
    .validacion-mensaje.incorrecta { color: #c62828; font-weight: 600; }

    /* Payment type buttons */
    .payment-options {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .payment-btn {
      flex: 1;
      min-width: 180px;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem 1.25rem;
      border: 2px solid #ddd;
      border-radius: 10px;
      background: #f5f5f5;
      color: #555;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .payment-btn .letter {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      background: #bbb;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
    }
    .payment-btn.active {
      border-color: #1a4d6d;
      background: #1a4d6d;
      color: #fff;
    }
    .payment-btn.active .letter { background: rgba(255,255,255,0.3); }
    .payment-btn:hover:not(.active) { border-color: #999; }

    /* Conditional payment content */
    .payment-content { display: none; margin-top: 1.25rem; }
    .payment-content.active { display: block; }
    .upload-zone {
      border: 2px dashed #ccc;
      border-radius: 10px;
      padding: 2rem;
      text-align: center;
      background: #fafafa;
      cursor: pointer;
      transition: border-color 0.2s;
    }
    .upload-zone:hover { border-color: #1a4d6d; }
    .upload-zone .icon { font-size: 2rem; margin-bottom: 0.5rem; }
    .upload-zone .size { font-size: 0.85rem; color: #666; margin-top: 0.25rem; }
    .upload-zone.has-file .upload-zone-default { display: none; }
    .comprobante-preview {
      display: none;
      margin-top: 1rem;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 10px;
      border: 1px solid #e0e0e0;
    }
    .comprobante-preview.visible { display: block; }
    .comprobante-preview img {
      max-width: 100%;
      max-height: 280px;
      width: auto;
      height: auto;
      display: block;
      margin: 0 auto 0.75rem;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    .comprobante-preview-pdf {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
      padding: 0.75rem;
      background: #fff;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    .comprobante-preview-pdf .pdf-icon { font-size: 2rem; color: #c62828; }
    .comprobante-preview-name { font-size: 0.9rem; color: #333; margin-bottom: 0.5rem; word-break: break-all; }
    .comprobante-preview-quitar {
      display: inline-block;
      padding: 0.4rem 0.75rem;
      font-size: 0.85rem;
      color: #c62828;
      background: transparent;
      border: 1px solid #c62828;
      border-radius: 6px;
      cursor: pointer;
    }
    .comprobante-preview-quitar:hover { background: #ffebee; }
    .aviso {
      margin-top: 1rem;
      padding: 1rem;
      background: #fff8e1;
      border-left: 4px solid #f57c00;
      border-radius: 0 8px 8px 0;
      font-size: 0.9rem;
      color: #333;
    }
    .aviso strong { color: #e65100; }

    /* Thank you page */
    .thanks-page .form-card {
      text-align: center;
      padding: 2.5rem;
    }
    .thanks-page h2 {
      font-size: 1.5rem;
      color: #333;
      margin: 0 0 1.25rem;
      line-height: 1.3;
    }
    .thanks-page .body-text {
      text-align: left;
      line-height: 1.6;
      color: #444;
      margin-bottom: 1.5rem;
    }
    .thanks-page a { color: #1976d2; text-decoration: none; }
    .thanks-page a:hover { text-decoration: underline; }
    .thanks-page .signature {
      text-align: left;
      margin-top: 1.5rem;
      font-size: 0.95rem;
      color: #555;
    }

    /* Responsive: usar mejor el ancho de la p√°gina */
    @media (min-width: 768px) {
      body { padding: 0 2rem 2rem; }
      .hela-header { margin: 0 -2rem 2rem; padding: 1.5rem 2rem; }
    }
    @media (min-width: 1024px) {
      body { max-width: 1000px; padding: 0 2.5rem 2rem; }
      .hela-header { margin: 0 -2.5rem 2rem; padding: 1.75rem 2.5rem; }
      .intro, .form-card { padding: 2.5rem; }
      .intro h1 { font-size: 1.65rem; }
    }
    @media (max-width: 767px) {
      body { padding: 0 0.75rem 1.25rem; }
      .hela-header { margin: 0 -0.75rem 1.5rem; padding: 1rem 0.75rem; }
      .hela-header .brand { font-size: 1.25rem; }
      .hela-header .year { font-size: 1.5rem; }
      .hela-header .gear { width: 40px; height: 40px; font-size: 1rem; }
      .intro, .form-card { padding: 1.25rem; }
      .intro h1 { font-size: 1.35rem; }
      .payment-btn { min-width: 100%; }
      .payment-options { flex-direction: column; }
    }
    @media (max-width: 480px) {
      body { padding: 0 0.5rem 1rem; }
      .hela-header { margin: 0 -0.5rem 1rem; padding: 0.75rem 0.5rem; }
      .intro, .form-card { padding: 1rem; }
      .intro h1 { font-size: 1.2rem; }
      .btn { width: 100%; justify-content: center; }
    }
  </style>
</head>
<body>
  <!-- Header (visible en todas las p√°ginas) -->
  <header class="hela-header" aria-hidden="true">
    <div class="logo">
      <span class="gear" aria-hidden="true">‚öô</span>
      <span class="brand">HeLa</span>
    </div>
    <span class="year">2026</span>
  </header>

  <!-- P√°gina 1: Landing -->
  <section id="page-intro" class="page active">
    <div class="intro">
      <h1>Carnets - Congreso HeLa 2026</h1>
      <p>Bienvenido al proceso de registro para el <strong>10¬∫ Congreso de Ingenier√≠a Biom√©dica HeLa 2026</strong>, que se llevar√° a cabo del <strong>22 al 24 de abril</strong> en el Teatro del Pueblo, Hermosillo, Sonora.</p>
      <p>Al adquirir tu carnet, tendr√°s acceso a todas las conferencias durante la semana del congreso, adem√°s de un taller y visita industrial de tu preferencia.</p>
      <p class="note">‚òÖ La venta de carnets se realiza en tres fases, con precios diferenciados seg√∫n la fecha de compra.</p>
    </div>
    <button type="button" class="btn" id="btn-continuar">Continuar registro ‚Üí</button>
  </section>

  <!-- P√°gina 2: Formulario -->
  <section id="page-form" class="page">
    <div class="form-card">
      <a href="#" class="back-link" id="link-atras">‚Üê Atr√°s</a>

      <form id="form-registro" novalidate>
        <h2 class="section-title">Secci√≥n 1 - Tipo de compra y fase de registro</h2>
        <div class="field" id="wrap-tipo-compra">
          <label for="tipo-compra">Tipo de compra <span class="req">*</span></label>
          <select id="tipo-compra" name="tipo_compra" required>
            <option value="">Selecciona una opci√≥n</option>
            <option value="fase1">Regular (Persona local)</option>
            <option value="fase2">Visitante (Persona de fuera)</option>
            <option value="fase3">Especial (Sorteo/Din√°mica)</option>
          </select>
          <span class="error-msg" id="err-tipo-compra"></span>
        </div>

        <h2 class="section-title">Secci√≥n 2 - Datos personales</h2>
        <p style="font-size: 0.9rem; color: #555; margin-bottom: 1rem;">
          Esta informaci√≥n ser√° utilizada para tu acreditaci√≥n, para asignarte el taller y visita industrial que elijas, realizar las asistencias del evento y entregarte una camiseta como parte de tu kit. Revisa antes de enviar tu formulario que tus datos est√©n bien escritos (nombre, correo y tel√©fono) para evitar problemas con tu certificado y actividades del congreso.
        </p>

        <div class="field" id="wrap-nombre">
          <label for="nombre">Nombre Completo <span class="req">*</span></label>
          <div class="hint"><span class="info-icon">‚Ñπ</span> Primero ingresa tus nombres y luego tus apellidos, utilizando may√∫scula inicial en cada nombre.</div>
          <input type="text" id="nombre" name="nombre" required placeholder="Ej. Carlos Alberto L√≥pez G√≥mez" autocomplete="name">
          <span class="error-msg" id="err-nombre"></span>
        </div>

        <div class="field" id="wrap-email">
          <label for="email">Correo electr√≥nico <span class="req">*</span></label>
          <div class="hint"><span class="info-icon">‚Ñπ</span> Ingresa un correo electr√≥nico al que tengas acceso y que cuente con espacio disponible para recibir mensajes. Por este medio se te har√° llegar tu c√≥digo QR de asistencia.</div>
          <input type="email" id="email" name="email" required placeholder="correo@ejemplo.com" autocomplete="email">
          <span class="error-msg" id="err-email"></span>
        </div>

        <div class="field" id="wrap-telefono">
          <label for="telefono">Tel√©fono <span class="req">*</span></label>
          <input type="tel" id="telefono" name="telefono" required placeholder="662 113 6679" autocomplete="tel" inputmode="numeric" pattern="[0-9\s]*" maxlength="15">
          <span class="error-msg" id="err-telefono"></span>
        </div>

        <div class="field" id="wrap-escuela">
          <label for="escuela">Escuela <span class="req">*</span></label>
          <input type="text" id="escuela" name="escuela" required placeholder="Ej. ITH" autocomplete="organization">
          <span class="error-msg" id="err-escuela"></span>
        </div>

        <div class="field" id="wrap-talla">
          <label for="talla">Talla de camiseta <span class="req">*</span></label>
          <select id="talla" name="talla" required>
            <option value="">Selecciona talla</option>
            <option value="S">S</option>
            <option value="M">M</option>
            <option value="L">L</option>
            <option value="XL">XL</option>
          </select>
          <span class="error-msg" id="err-talla"></span>
        </div>

        <h2 class="section-title">Secci√≥n 3 - Forma de pago</h2>
        <div class="field" id="wrap-tipo-pago">
          <label>Tipo de pago <span class="req">*</span></label>
          <div class="payment-options">
            <button type="button" class="payment-btn" id="btn-pago-fisico" data-value="fisico">
              <span class="letter">A</span> Pago f√≠sico
            </button>
            <button type="button" class="payment-btn" id="btn-transferencia" data-value="transferencia">
              <span class="letter">B</span> Transferencia bancaria
            </button>
          </div>
          <input type="hidden" id="tipo-pago" name="tipo_pago" value="">
          <span class="error-msg" id="err-tipo-pago"></span>
        </div>

        <!-- Contenido Pago f√≠sico -->
        <div id="content-pago-fisico" class="payment-content">
          <div class="field" id="wrap-password">
            <label for="password-vendedor">Contrase√±a del vendedor</label>
            <input type="password" id="password-vendedor" name="password_vendedor" placeholder="Contrase√±a" autocomplete="off">
            <span class="error-msg" id="err-password"></span>
          </div>
          <div class="field" id="wrap-validacion">
            <label>Validaci√≥n contrase√±a</label>
            <div id="validacion-mensaje" class="validacion-mensaje" aria-live="polite"></div>
          </div>
        </div>

        <!-- Contenido Transferencia bancaria -->
        <div id="content-transferencia" class="payment-content">
          <div class="field" id="wrap-comprobante">
            <label>Comprobante de transferencia <span class="req">*</span></label>
            <div class="upload-zone" id="upload-zone" role="button" tabindex="0">
              <div class="upload-zone-default">
                <div class="icon">‚Üë</div>
                <div>Selecciona para obtener el archivo o arr√°stralo hasta aqu√≠</div>
                <div class="size">Tama√±o permitido: 10 MB</div>
              </div>
              <div class="comprobante-preview" id="comprobante-preview">
                <img id="comprobante-preview-img" alt="Vista previa del comprobante" style="display: none;">
                <div class="comprobante-preview-pdf" id="comprobante-preview-pdf" style="display: none;">
                  <span class="pdf-icon" aria-hidden="true">üìÑ</span>
                  <span class="comprobante-preview-name" id="comprobante-preview-pdf-name"></span>
                </div>
                <div class="comprobante-preview-name" id="comprobante-preview-filename"></div>
                <button type="button" class="comprobante-preview-quitar" id="comprobante-quitar">Quitar archivo</button>
              </div>
            </div>
            <input type="file" id="comprobante" name="comprobante" accept="image/*,.pdf" hidden>
            <span class="error-msg" id="err-comprobante"></span>
          </div>
          <div class="aviso">
            !! Aviso importante !!<br>
            Al enviar tu formulario, se verificar√° la imagen del <strong>comprobante de transferencia</strong>. En caso de que la fecha del comprobante no concuerde con la fecha de env√≠o del formulario ni con el precio correspondiente a la fase de venta, <strong>se anular√° la emisi√≥n de tu carnet</strong> y no se realizar√°n <strong>devoluciones monetarias</strong>.
          </div>
        </div>

        <div style="margin-top: 2rem;">
          <button type="submit" class="btn" id="btn-enviar">Finalizar registro ‚Üí</button>
        </div>
      </form>
    </div>
  </section>

  <!-- P√°gina 3: Gracias -->
  <section id="page-thanks" class="page">
    <div class="form-card thanks-page">
      <h2>¬°Gracias por tu inscripci√≥n al Congreso HeLa 2026!</h2>
      <div class="body-text">
        <p>Te agradecemos tu inter√©s en participar en la d√©cima edici√≥n del <strong>Congreso HeLa 2026</strong>.</p>
        <p>Mantente al pendiente de tu correo electr√≥nico, ya que por ese medio se te har√° llegar tu c√≥digo QR de asistencia.</p>
        <p>Te recomendamos seguir nuestras redes sociales para estar al tanto de sorpresas y novedades.</p>
        <p>Para cualquier duda o informaci√≥n adicional, cont√°ctanos:</p>
        <ul style="list-style: none; padding: 0;">
          <li>Correo: <a href="mailto:congresohela@gmail.com">congresohela@gmail.com</a></li>
          <li>Instagram: <a href="https://instagram.com/congreso.hela" target="_blank" rel="noopener">@congreso.hela</a></li>
        </ul>
      </div>
      <div class="signature">
        Atentamente,<br>
        <strong>Comit√© Organizador - Congreso HeLa 2026</strong><br>
        Instituto Tecnol√≥gico de Hermosillo
      </div>
    </div>
  </section>

  <script>
    (function () {
      // Pega aqu√≠ la URL de tu Web App de Google Apps Script (Deploy ‚Üí New deployment ‚Üí Web app)
      // Ejemplo: 'https://script.google.com/macros/s/AKfycbz.../exec'
      var GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwH2R4Ky909T54eqxeC8mAzSrEZN1kmD2xTEo8GLuMQ3wUlRHkISq5-OgpmN4aHFF8h/exec';

      var MAX_FILE_MB = 10;
      var MAX_FILE_MB_ENVIO = 5;
      var pageIntro = document.getElementById('page-intro');
      var pageForm = document.getElementById('page-form');
      var pageThanks = document.getElementById('page-thanks');
      var btnContinuar = document.getElementById('btn-continuar');
      var linkAtras = document.getElementById('link-atras');
      var form = document.getElementById('form-registro');
      var tipoPagoInput = document.getElementById('tipo-pago');
      var btnPagoFisico = document.getElementById('btn-pago-fisico');
      var btnTransferencia = document.getElementById('btn-transferencia');
      var contentPagoFisico = document.getElementById('content-pago-fisico');
      var contentTransferencia = document.getElementById('content-transferencia');
      var comprobanteInput = document.getElementById('comprobante');
      var uploadZone = document.getElementById('upload-zone');

      function showPage(page) {
        pageIntro.classList.remove('active');
        pageForm.classList.remove('active');
        pageThanks.classList.remove('active');
        page.classList.add('active');
      }

      btnContinuar.addEventListener('click', function () {
        showPage(pageForm);
      });

      linkAtras.addEventListener('click', function (e) {
        e.preventDefault();
        showPage(pageIntro);
      });

      document.getElementById('telefono').addEventListener('input', function () {
        this.value = this.value.replace(/\D/g, '');
      });

      var PASSWORD_CORRECTA = 'CONGRESO2026';

      function updateValidacionMensaje() {
        var el = document.getElementById('validacion-mensaje');
        if (!el) return;
        var pass = document.getElementById('password-vendedor').value;
        el.className = 'validacion-mensaje';
        if (!pass) {
          el.textContent = '';
          return;
        }
        if (pass === PASSWORD_CORRECTA) {
          el.textContent = 'Contrase√±a correcta';
          el.classList.add('correcta');
        } else {
          el.textContent = 'Contrase√±a incorrecta.';
          el.classList.add('incorrecta');
        }
      }

      document.getElementById('password-vendedor').addEventListener('input', updateValidacionMensaje);
      document.getElementById('password-vendedor').addEventListener('blur', updateValidacionMensaje);

      function setPaymentType(value) {
        tipoPagoInput.value = value;
        document.getElementById('err-tipo-pago').textContent = '';
        document.getElementById('wrap-tipo-pago').classList.remove('error');

        btnPagoFisico.classList.toggle('active', value === 'fisico');
        btnTransferencia.classList.toggle('active', value === 'transferencia');
        contentPagoFisico.classList.toggle('active', value === 'fisico');
        contentTransferencia.classList.toggle('active', value === 'transferencia');

        if (value === 'fisico') {
          document.getElementById('comprobante').removeAttribute('required');
          document.getElementById('password-vendedor').setAttribute('required', '');
          updateValidacionMensaje();
        } else if (value === 'transferencia') {
          document.getElementById('password-vendedor').removeAttribute('required');
          document.getElementById('comprobante').setAttribute('required', '');
          document.getElementById('validacion-mensaje').textContent = '';
          document.getElementById('validacion-mensaje').className = 'validacion-mensaje';
        }
      }

      btnPagoFisico.addEventListener('click', function () { setPaymentType('fisico'); });
      btnTransferencia.addEventListener('click', function () { setPaymentType('transferencia'); });

      var comprobantePreviewUrl = null;

      function updateComprobantePreview() {
        var preview = document.getElementById('comprobante-preview');
        var previewImg = document.getElementById('comprobante-preview-img');
        var previewPdf = document.getElementById('comprobante-preview-pdf');
        var previewPdfName = document.getElementById('comprobante-preview-pdf-name');
        var previewFilename = document.getElementById('comprobante-preview-filename');
        var defaultBlock = uploadZone.querySelector('.upload-zone-default');

        if (comprobantePreviewUrl) {
          URL.revokeObjectURL(comprobantePreviewUrl);
          comprobantePreviewUrl = null;
        }

        var file = comprobanteInput.files && comprobanteInput.files[0];
        if (!file) {
          preview.classList.remove('visible');
          previewImg.style.display = 'none';
          previewPdf.style.display = 'none';
          previewFilename.textContent = '';
          if (defaultBlock) defaultBlock.style.display = '';
          uploadZone.classList.remove('has-file');
          return;
        }

        uploadZone.classList.add('has-file');
        if (defaultBlock) defaultBlock.style.display = 'none';
        preview.classList.add('visible');
        previewFilename.textContent = file.name + ' (' + (file.size / 1024).toFixed(1) + ' KB)';

        if (file.type.indexOf('image/') === 0) {
          comprobantePreviewUrl = URL.createObjectURL(file);
          previewImg.src = comprobantePreviewUrl;
          previewImg.style.display = 'block';
          previewPdf.style.display = 'none';
        } else {
          previewImg.style.display = 'none';
          previewPdf.style.display = 'flex';
          previewPdfName.textContent = file.name;
        }
      }

      document.getElementById('comprobante-quitar').addEventListener('click', function (e) {
        e.preventDefault();
        e.stopPropagation();
        comprobanteInput.value = '';
        updateComprobantePreview();
      });

      uploadZone.addEventListener('click', function (e) {
        if (!e.target.closest('.comprobante-preview-quitar')) comprobanteInput.click();
      });
      uploadZone.addEventListener('keydown', function (e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          if (!e.target.closest('.comprobante-preview-quitar')) comprobanteInput.click();
        }
      });
      comprobanteInput.addEventListener('change', function () {
        var file = this.files[0];
        if (file && file.size > MAX_FILE_MB * 1024 * 1024) {
          alert('El archivo no debe superar ' + MAX_FILE_MB + ' MB.');
          this.value = '';
        }
        updateComprobantePreview();
      });
      uploadZone.addEventListener('dragover', function (e) {
        e.preventDefault();
        uploadZone.style.borderColor = '#1a4d6d';
      });
      uploadZone.addEventListener('dragleave', function () {
        uploadZone.style.borderColor = '';
      });
      uploadZone.addEventListener('drop', function (e) {
        e.preventDefault();
        uploadZone.style.borderColor = '';
        if (e.dataTransfer.files.length) {
          comprobanteInput.files = e.dataTransfer.files;
          if (comprobanteInput.files[0].size > MAX_FILE_MB * 1024 * 1024) {
            alert('El archivo no debe superar ' + MAX_FILE_MB + ' MB.');
            comprobanteInput.value = '';
          }
          updateComprobantePreview();
        }
      });

      var requiredFields = [
        { id: 'tipo-compra', wrap: 'wrap-tipo-compra', err: 'err-tipo-compra' },
        { id: 'nombre', wrap: 'wrap-nombre', err: 'err-nombre' },
        { id: 'email', wrap: 'wrap-email', err: 'err-email' },
        { id: 'telefono', wrap: 'wrap-telefono', err: 'err-telefono' },
        { id: 'escuela', wrap: 'wrap-escuela', err: 'err-escuela' },
        { id: 'talla', wrap: 'wrap-talla', err: 'err-talla' }
      ];

      function clearErrors() {
        requiredFields.forEach(function (f) {
          document.getElementById(f.wrap).classList.remove('error');
          document.getElementById(f.err).textContent = '';
        });
        document.getElementById('wrap-tipo-pago').classList.remove('error');
        document.getElementById('err-tipo-pago').textContent = '';
        document.getElementById('wrap-password').classList.remove('error');
        document.getElementById('err-password').textContent = '';
        document.getElementById('wrap-validacion').classList.remove('error');
        var validacionMsg = document.getElementById('validacion-mensaje');
        if (validacionMsg) {
          validacionMsg.textContent = '';
          validacionMsg.className = 'validacion-mensaje';
        }
        document.getElementById('wrap-comprobante').classList.remove('error');
        var errComp = document.getElementById('err-comprobante');
        if (errComp) errComp.textContent = '';
      }

      function setError(wrapId, errId, msg) {
        document.getElementById(wrapId).classList.add('error');
        document.getElementById(errId).textContent = msg;
      }

      function validate() {
        clearErrors();
        var tipoPago = tipoPagoInput.value.trim();
        var valid = true;

        if (!tipoPago) {
          setError('wrap-tipo-pago', 'err-tipo-pago', 'Selecciona el tipo de pago.');
          valid = false;
        }

        requiredFields.forEach(function (f) {
          var el = document.getElementById(f.id);
          var val = el.value.trim();
          if (!val) {
            document.getElementById(f.wrap).classList.add('error');
            document.getElementById(f.err).textContent = 'Este campo es obligatorio.';
            valid = false;
          }
        });

        if (tipoPago === 'fisico') {
          var pass = document.getElementById('password-vendedor').value;
          if (!pass) {
            setError('wrap-password', 'err-password', 'Ingresa la contrase√±a del vendedor.');
            valid = false;
          } else if (pass !== PASSWORD_CORRECTA) {
            setError('wrap-password', 'err-password', 'La contrase√±a es incorrecta.');
            valid = false;
          }
        } else if (tipoPago === 'transferencia') {
          if (!comprobanteInput.files || !comprobanteInput.files.length) {
            setError('wrap-comprobante', 'err-comprobante', 'Debes subir el comprobante de transferencia.');
            valid = false;
          }
        }

        return valid;
      }

      function buildPayload(callback) {
        var payload = {
          fecha: new Date().toISOString(),
          tipo_compra: document.getElementById('tipo-compra').value,
          nombre: document.getElementById('nombre').value.trim(),
          email: document.getElementById('email').value.trim(),
          telefono: document.getElementById('telefono').value.trim(),
          escuela: document.getElementById('escuela').value.trim(),
          talla: document.getElementById('talla').value,
          tipo_pago: document.getElementById('tipo-pago').value,
          password_vendedor: document.getElementById('password-vendedor').value || '',
          comprobante_nombre: '',
          comprobante_base64: '',
          comprobante_tipo: ''
        };

        var file = comprobanteInput.files && comprobanteInput.files[0];
        if (file) {
          payload.comprobante_nombre = file.name;
          payload.comprobante_tipo = file.type || 'application/octet-stream';
          if (file.size <= MAX_FILE_MB_ENVIO * 1024 * 1024) {
            var reader = new FileReader();
            reader.onload = function () {
              var dataUrl = reader.result;
              payload.comprobante_base64 = dataUrl.indexOf('base64,') >= 0 ? dataUrl.split('base64,')[1] : dataUrl;
              callback(payload);
            };
            reader.readAsDataURL(file);
          } else {
            callback(payload);
          }
        } else {
          callback(payload);
        }
      }

      form.addEventListener('submit', function (e) {
        e.preventDefault();
        if (!validate()) {
          var firstError = document.querySelector('.field.error');
          if (firstError) firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
          return;
        }

        var btnEnviar = document.getElementById('btn-enviar');
        var textoOriginal = btnEnviar.textContent;
        btnEnviar.disabled = true;
        btnEnviar.textContent = 'Enviando‚Ä¶';

        buildPayload(function (payload) {
          if (!GOOGLE_SCRIPT_URL) {
            btnEnviar.disabled = false;
            btnEnviar.textContent = textoOriginal;
            showPage(pageThanks);
            return;
          }

          fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          }).then(function () {
            btnEnviar.disabled = false;
            btnEnviar.textContent = textoOriginal;
            showPage(pageThanks);
          }).catch(function (err) {
            btnEnviar.disabled = false;
            btnEnviar.textContent = textoOriginal;
            alert('No se pudo guardar el registro. Revisa la consola o intenta de nuevo.');
            console.error(err);
          });
        });
      });
    })();
  </script>
</body>
</html>
