<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Congreso HeLa 2026</title>
  <style>
    * { box-sizing: border-box; }
    html { width: 100%; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      width: 100%;
      min-height: 100vh;
      margin: 0;
      padding: 0 0.75rem 1rem;
      color: #1a1a1a;
      background: #f5f6f8;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .breadcrumb {
      width: 100%;
      max-width: 960px;
      margin: 0 auto 0.25rem;
      padding: 0 0.5rem;
      font-size: 0.8rem;
      color: #666;
    }
    .form-wrapper { width: 100%; max-width: 960px; flex-shrink: 0; padding: 0; margin: 0 auto; }
    .page { display: none; }
    .page.active { display: block; }

    /* Cuadro blanco: franja azul pegada al contenido (sin espacios) */
    .card-blanca {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,.08);
      overflow: hidden;
      margin-bottom: 1rem;
    }
    /* Franja azul: ★ Congreso HeLa | 2026 */
    .hela-header {
      background: linear-gradient(135deg, #a8d4e8 0%, #c5e3f0 100%);
      padding: 0.5rem 1rem;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .hela-header .logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .hela-header .star { font-size: 1.25rem; color: #1a4d6d; }
    .hela-header .brand { font-size: 1.25rem; font-weight: 700; color: #1a4d6d; }
    .hela-header .sep { color: #1a4d6d; opacity: 0.8; margin: 0 0.25rem; }
    .hela-header .year { font-size: 1.5rem; font-weight: 800; color: #1a4d6d; }

    .intro {
      padding: 1rem 1.25rem;
      margin: 0;
    }
    .intro p { margin: 0 0 0.5rem; line-height: 1.6; color: #444; font-size: 0.95rem; }
    .intro .note {
      background: #f0f9e8;
      border-left: 4px solid #7cb342;
      padding: 0.6rem 0.85rem;
      margin-top: 0.75rem;
      font-size: 0.9rem;
      color: #333;
    }
    .intro .note p { margin: 0 0 0.5rem; }
    .intro .note p:last-child { margin-bottom: 0; }
    .intro .note .star { color: #7cb342; }
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.6rem 1.25rem;
      background: #1a4d6d;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
    }
    .btn:hover { background: #153a52; }
    .btn:disabled { opacity: 0.7; cursor: not-allowed; }

    .form-card {
      background: #fff;
      padding: 1.25rem 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,.08);
    }
    .back-link {
      display: inline-block;
      margin-bottom: 0.75rem;
      color: #1a4d6d;
      text-decoration: none;
      font-size: 0.9rem;
    }
    .back-link:hover { text-decoration: underline; }
    .section-title {
      color: #2e7d32;
      font-size: 1.05rem;
      font-weight: 700;
      margin: 1.25rem 0 0.5rem;
    }
    .section-title:first-child { margin-top: 0; }
    .field { margin-bottom: 1rem; }
    .field label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.3rem;
      color: #333;
      font-size: 0.95rem;
    }
    .field label .req { color: #c62828; }
    .field .hint {
      display: flex;
      align-items: flex-start;
      gap: 0.35rem;
      font-size: 0.8rem;
      color: #555;
      margin-bottom: 0.3rem;
    }
    .field .hint .info-icon { color: #1976d2; }
    .field input[type="text"],
    .field input[type="email"],
    .field input[type="tel"],
    .field input[type="password"],
    .field select {
      width: 100%;
      padding: 0.5rem 0.65rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 0.95rem;
    }
    .field input:focus, .field select:focus {
      outline: none;
      border-color: #1a4d6d;
      box-shadow: 0 0 0 2px rgba(26,77,109,.15);
    }
    .field.error input, .field.error select { border-color: #c62828; }
    .field .error-msg { font-size: 0.8rem; color: #c62828; margin-top: 0.2rem; }
    .validacion-mensaje { font-size: 0.9rem; margin-top: 0.3rem; min-height: 1.3em; }
    .validacion-mensaje.correcta { color: #2e7d32; font-weight: 600; }
    .validacion-mensaje.incorrecta { color: #c62828; font-weight: 600; }

    .precio-box {
      margin-top: 0.5rem;
      padding: 0.6rem 0.85rem;
      background: #e8f5e9;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 700;
      color: #1b5e20;
    }

    .payment-options { display: flex; gap: 0.75rem; flex-wrap: wrap; }
    .payment-btn {
      flex: 1;
      min-width: 160px;
      display: flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.75rem 1rem;
      border: 2px solid #ddd;
      border-radius: 10px;
      background: #f5f5f5;
      color: #555;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .payment-btn .letter {
      width: 28px; height: 28px;
      border-radius: 6px;
      background: #bbb;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
    }
    .payment-btn.active {
      border-color: #1a4d6d;
      background: #1a4d6d;
      color: #fff;
    }
    .payment-btn.active .letter { background: rgba(255,255,255,0.3); }
    .payment-btn:hover:not(.active) { border-color: #999; }

    .payment-content { display: none; margin-top: 1rem; }
    .payment-content.active { display: block; }
    .upload-zone {
      border: 2px dashed #ccc;
      border-radius: 10px;
      padding: 1.25rem;
      text-align: center;
      background: #fafafa;
      cursor: pointer;
      transition: border-color 0.2s;
    }
    .upload-zone:hover { border-color: #1a4d6d; }
    .upload-zone .icon { font-size: 1.75rem; margin-bottom: 0.4rem; }
    .upload-zone .size { font-size: 0.8rem; color: #666; margin-top: 0.2rem; }
    .upload-zone.has-file .upload-zone-default { display: none; }
    .comprobante-preview {
      display: none;
      margin-top: 0.75rem;
      padding: 0.75rem;
      background: #f8f9fa;
      border-radius: 10px;
      border: 1px solid #e0e0e0;
    }
    .comprobante-preview.visible { display: block; }
    .comprobante-preview img {
      max-width: 100%;
      max-height: 240px;
      width: auto;
      height: auto;
      display: block;
      margin: 0 auto 0.5rem;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    .comprobante-preview-pdf {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
      padding: 0.5rem;
      background: #fff;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    .comprobante-preview-pdf .pdf-icon { font-size: 1.75rem; color: #c62828; }
    .comprobante-preview-name { font-size: 0.85rem; color: #333; margin-bottom: 0.4rem; word-break: break-all; }
    .comprobante-preview-quitar {
      display: inline-block;
      padding: 0.35rem 0.6rem;
      font-size: 0.8rem;
      color: #c62828;
      background: transparent;
      border: 1px solid #c62828;
      border-radius: 6px;
      cursor: pointer;
    }
    .comprobante-preview-quitar:hover { background: #ffebee; }
    .aviso {
      margin-top: 0.75rem;
      padding: 0.75rem 0.85rem;
      background: #fff8e1;
      border-left: 4px solid #f57c00;
      border-radius: 0 8px 8px 0;
      font-size: 0.85rem;
      color: #333;
    }
    .aviso strong { color: #e65100; }

    .thanks-page .form-card { text-align: center; padding: 2rem; }
    .thanks-page h2 {
      font-size: 1.35rem;
      color: #333;
      margin: 0 0 1rem;
      line-height: 1.3;
    }
    .thanks-page .body-text {
      text-align: left;
      line-height: 1.6;
      color: #444;
      margin-bottom: 1.25rem;
      font-size: 0.95rem;
    }
    .thanks-page a { color: #1976d2; text-decoration: none; }
    .thanks-page a:hover { text-decoration: underline; }
    .thanks-page .signature {
      text-align: left;
      margin-top: 1.25rem;
      font-size: 0.9rem;
      color: #555;
    }

    @media (min-width: 768px) {
      body { padding: 0 1.5rem 1.5rem; }
      .hela-header { padding: 0.75rem 1.5rem; }
      .hela-header .brand { font-size: 1.5rem; }
      .hela-header .year { font-size: 1.75rem; }
      .intro { padding: 1.5rem 2rem; }
      .form-card { padding: 2rem; }
    }
    @media (min-width: 1024px) {
      body { padding: 0 2rem 2rem; }
      .hela-header { padding: 1rem 2rem; }
      .hela-header .brand { font-size: 1.65rem; }
      .hela-header .year { font-size: 1.9rem; }
      .intro, .form-card { padding: 2rem 2.5rem; }
    }
    @media (max-width: 767px) {
      body { padding: 0 0.5rem 0.75rem; }
      .hela-header { padding: 0.4rem 0.75rem; }
      .hela-header .brand { font-size: 1.1rem; }
      .hela-header .year { font-size: 1.35rem; }
      .hela-header .star { font-size: 1.1rem; }
      .intro { padding: 0.75rem 1rem; }
      .form-card { padding: 1rem; }
      .payment-btn { min-width: 100%; }
      .payment-options { flex-direction: column; }
      .field { margin-bottom: 0.85rem; }
    }
    @media (max-width: 480px) {
      body { padding: 0 0.4rem 0.6rem; }
      .hela-header { padding: 0.35rem 0.6rem; }
      .hela-header .brand { font-size: 1rem; }
      .hela-header .year { font-size: 1.2rem; }
      .intro, .form-card { padding: 0.6rem 0.75rem; }
      .btn { width: 100%; justify-content: center; padding: 0.5rem 1rem; }
    }
  </style>
</head>
<body>
  <p class="breadcrumb">Inicio / Registro de Carnet</p>

  <div class="form-wrapper">
    <!-- page-intro: franja azul pegada al cuadro blanco -->
    <section id="page-intro" class="page active">
      <div class="card-blanca">
        <header class="hela-header" aria-hidden="true">
          <div class="logo">
            <span class="star">★</span>
            <span class="brand">Congreso HeLa</span>
            <span class="sep">|</span>
          </div>
          <span class="year">2026</span>
        </header>
        <div class="intro">
          <p>Bienvenido al proceso de registro para el <strong>10º Congreso de Ingeniería Biomédica HeLa 2026</strong>, que se llevará a cabo del <strong>22 al 24 de abril</strong> en el Teatro del Pueblo, Hermosillo, Sonora.</p>
          <p>Al adquirir tu carnet tendrás acceso a todas las conferencias durante la semana del congreso, además de un taller y visita industrial de tu preferencia, así como a los eventos durante esos días.</p>
          <div class="note">
            <p><span class="star">★</span> La venta de carnets se realiza en tres fases, con precios diferenciados según la fecha de compra.</p>
            <p><span class="star">★</span> Este formulario es exclusivo para carnet Regular. Para otros tipos (visitante, especial, etc.) contacta al comité en: congresohela@gmail.com</p>
          </div>
        </div>
      </div>
      <button type="button" class="btn" id="btn-continuar">Continuar registro &rarr;</button>
    </section>

    <section id="page-form" class="page">
      <div class="form-card">
        <a href="#" class="back-link" id="link-atras">&larr; Atrás</a>

        <form id="form-registro" novalidate>
          <h2 class="section-title">Sección 1 - Información del carnet</h2>
          <p style="font-size: 0.95rem; color: #333; margin-bottom: 0.75rem;">
            Este formulario corresponde al carnet <strong>Regular</strong> del Congreso HeLa 2026.
          </p>
          <div class="precio-box">
            Precio del carnet Regular: <span id="precio-valor">$800</span>
          </div>

          <h2 class="section-title">Sección 2 - Datos personales</h2>
          <p style="font-size: 0.9rem; color: #555; margin-bottom: 0.75rem;">
            Esta información será utilizada para tu acreditación, para asignarte el taller y visita industrial que elijas, realizar las asistencias del evento y entregarte una camiseta como parte de tu kit. Revisa antes de enviar que tus datos estén bien escritos (nombre, correo y teléfono).
          </p>

          <div class="field" id="wrap-nombre">
            <label for="nombre">Nombre Completo <span class="req">*</span></label>
            <div class="hint"><span class="info-icon">&#8505;</span> Primero nombres y luego apellidos, con mayúscula inicial.</div>
            <input type="text" id="nombre" name="nombre" required placeholder="Ej. Carlos Alberto López Gómez" autocomplete="name">
            <span class="error-msg" id="err-nombre"></span>
          </div>

          <div class="field" id="wrap-email">
            <label for="email">Correo electrónico <span class="req">*</span></label>
            <div class="hint"><span class="info-icon">&#8505;</span> Correo con espacio para recibir tu código QR de asistencia.</div>
            <input type="email" id="email" name="email" required placeholder="correo@ejemplo.com" autocomplete="email">
            <span class="error-msg" id="err-email"></span>
          </div>

          <div class="field" id="wrap-telefono">
            <label for="telefono">Teléfono <span class="req">*</span></label>
            <input type="tel" id="telefono" name="telefono" required placeholder="662 113 6679" autocomplete="tel" inputmode="numeric" pattern="[0-9\s]*" maxlength="15">
            <span class="error-msg" id="err-telefono"></span>
          </div>

          <div class="field" id="wrap-escuela">
            <label for="escuela">Escuela <span class="req">*</span></label>
            <input type="text" id="escuela" name="escuela" required placeholder="Ej. ITH" autocomplete="organization">
            <span class="error-msg" id="err-escuela"></span>
          </div>

          <div class="field" id="wrap-talla">
            <label for="talla">Talla de camiseta <span class="req">*</span></label>
            <select id="talla" name="talla" required>
              <option value="">Selecciona talla</option>
              <option value="S">S</option>
              <option value="M">M</option>
              <option value="L">L</option>
              <option value="XL">XL</option>
            </select>
            <span class="error-msg" id="err-talla"></span>
          </div>

          <h2 class="section-title">Sección 3 - Forma de pago</h2>
          <div class="field" id="wrap-tipo-pago">
            <label>Tipo de pago <span class="req">*</span></label>
            <div class="payment-options">
              <button type="button" class="payment-btn" id="btn-pago-fisico" data-value="fisico">
                <span class="letter">A</span> Pago físico
              </button>
              <button type="button" class="payment-btn" id="btn-transferencia" data-value="transferencia">
                <span class="letter">B</span> Transferencia bancaria
              </button>
            </div>
            <input type="hidden" id="tipo-pago" name="tipo_pago" value="">
            <span class="error-msg" id="err-tipo-pago"></span>
          </div>

          <div id="content-pago-fisico" class="payment-content">
            <div class="field" id="wrap-password">
              <label for="password-vendedor">Contraseña del vendedor</label>
              <input type="password" id="password-vendedor" name="password_vendedor" placeholder="Contraseña" autocomplete="off">
              <span class="error-msg" id="err-password"></span>
            </div>
            <div class="field" id="wrap-validacion">
              <label>Validación contraseña</label>
              <div id="validacion-mensaje" class="validacion-mensaje" aria-live="polite"></div>
            </div>
          </div>

          <div id="content-transferencia" class="payment-content">
            <div class="field" id="wrap-comprobante">
              <label>Comprobante de transferencia <span class="req">*</span></label>
              <div class="upload-zone" id="upload-zone" role="button" tabindex="0">
                <div class="upload-zone-default">
                  <div class="icon">&#8593;</div>
                  <div>Selecciona o arrastra el archivo aquí</div>
                  <div class="size">Máximo 10 MB</div>
                </div>
                <div class="comprobante-preview" id="comprobante-preview">
                  <img id="comprobante-preview-img" alt="Vista previa" style="display: none;">
                  <div class="comprobante-preview-pdf" id="comprobante-preview-pdf" style="display: none;">
                    <span class="pdf-icon" aria-hidden="true">&#128196;</span>
                    <span class="comprobante-preview-name" id="comprobante-preview-pdf-name"></span>
                  </div>
                  <div class="comprobante-preview-name" id="comprobante-preview-filename"></div>
                  <button type="button" class="comprobante-preview-quitar" id="comprobante-quitar">Quitar archivo</button>
                </div>
              </div>
              <input type="file" id="comprobante" name="comprobante" accept="image/*,.pdf" hidden>
              <span class="error-msg" id="err-comprobante"></span>
            </div>
            <div class="aviso">
              Aviso: Se verificará el comprobante. Si la fecha o el monto no concuerdan, se anulará la emisión del carnet y no hay devoluciones.
            </div>
          </div>

          <div class="aviso">
            <strong>Importante:</strong> ¡SUBIR COMPROBANTE DE LA TRANSFERENCIA REALIZADA CON EL BANCO DE SU PREFERENCIA! Si los datos capturados o el comprobante de pago no son claros, no corresponden al monto correcto o a las fechas de venta, tu carnet <strong>no será registrado</strong>.
            La forma oficial de confirmar tu registro es revisando tu correo electrónico: ahí recibirás tu <strong>ticket con código QR</strong> o, en su caso, un <strong>correo de rechazo</strong> para contactar al comité.
          </div>

          <div style="margin-top: 1.5rem;">
            <button type="submit" class="btn" id="btn-enviar">Finalizar registro &rarr;</button>
          </div>
        </form>
      </div>
    </section>

    <section id="page-thanks" class="page">
      <div class="form-card thanks-page">
        <h2>¡Gracias por tu inscripción al Congreso HeLa 2026!</h2>
        <div class="body-text">
          <p>Te agradecemos tu interés en participar en la décima edición del <strong>Congreso HeLa 2026</strong>.</p>
          <p>Mantente al pendiente de tu correo electrónico; por ese medio se te hará llegar tu código QR de asistencia.</p>
          <p>Para cualquier duda: <a href="mailto:congresohela@gmail.com">congresohela@gmail.com</a> | <a href="https://instagram.com/congreso.hela" target="_blank" rel="noopener">@congreso.hela</a></p>
        </div>
        <div class="signature">
          Atentamente,<br>
          <strong>Comité Organizador - Congreso HeLa 2026</strong><br>
          Instituto Tecnológico de Hermosillo
        </div>
      </div>
    </section>
  </div>

  <script>
    (function () {
      var GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxG8052S3r9X9CzsA5DZOU1p6u9NE0GShOXnKUjahIagJeK4ZkHYVH7aZVVshItZh53/exec';

      var MAX_FILE_MB = 10;
      var MAX_FILE_MB_ENVIO = 5;

      var pageIntro = document.getElementById('page-intro');
      var pageForm = document.getElementById('page-form');
      var pageThanks = document.getElementById('page-thanks');
      var btnContinuar = document.getElementById('btn-continuar');
      var linkAtras = document.getElementById('link-atras');
      var form = document.getElementById('form-registro');
      var tipoPagoInput = document.getElementById('tipo-pago');
      var btnPagoFisico = document.getElementById('btn-pago-fisico');
      var btnTransferencia = document.getElementById('btn-transferencia');
      var contentPagoFisico = document.getElementById('content-pago-fisico');
      var contentTransferencia = document.getElementById('content-transferencia');
      var comprobanteInput = document.getElementById('comprobante');
      var uploadZone = document.getElementById('upload-zone');

      function showPage(page) {
        pageIntro.classList.remove('active');
        pageForm.classList.remove('active');
        pageThanks.classList.remove('active');
        page.classList.add('active');
      }

      btnContinuar.addEventListener('click', function () { showPage(pageForm); });
      linkAtras.addEventListener('click', function (e) { e.preventDefault(); showPage(pageIntro); });

      document.getElementById('telefono').addEventListener('input', function () {
        this.value = this.value.replace(/\D/g, '');
      });

      var PASSWORD_CORRECTA = 'CONGRESO2026';
      function updateValidacionMensaje() {
        var el = document.getElementById('validacion-mensaje');
        if (!el) return;
        var pass = document.getElementById('password-vendedor').value;
        el.className = 'validacion-mensaje';
        if (!pass) { el.textContent = ''; return; }
        if (pass === PASSWORD_CORRECTA) {
          el.textContent = 'Contraseña correcta';
          el.classList.add('correcta');
        } else {
          el.textContent = 'Contraseña incorrecta.';
          el.classList.add('incorrecta');
        }
      }
      document.getElementById('password-vendedor').addEventListener('input', updateValidacionMensaje);
      document.getElementById('password-vendedor').addEventListener('blur', updateValidacionMensaje);

      function setPaymentType(value) {
        tipoPagoInput.value = value;
        document.getElementById('err-tipo-pago').textContent = '';
        document.getElementById('wrap-tipo-pago').classList.remove('error');
        btnPagoFisico.classList.toggle('active', value === 'fisico');
        btnTransferencia.classList.toggle('active', value === 'transferencia');
        contentPagoFisico.classList.toggle('active', value === 'fisico');
        contentTransferencia.classList.toggle('active', value === 'transferencia');
        if (value === 'fisico') {
          comprobanteInput.removeAttribute('required');
          document.getElementById('password-vendedor').setAttribute('required', '');
          updateValidacionMensaje();
        } else {
          document.getElementById('password-vendedor').removeAttribute('required');
          comprobanteInput.setAttribute('required', '');
          var vm = document.getElementById('validacion-mensaje');
          vm.textContent = '';
          vm.className = 'validacion-mensaje';
        }
      }
      btnPagoFisico.addEventListener('click', function () { setPaymentType('fisico'); });
      btnTransferencia.addEventListener('click', function () { setPaymentType('transferencia'); });

      var comprobantePreviewUrl = null;
      function updateComprobantePreview() {
        var preview = document.getElementById('comprobante-preview');
        var previewImg = document.getElementById('comprobante-preview-img');
        var previewPdf = document.getElementById('comprobante-preview-pdf');
        var previewPdfName = document.getElementById('comprobante-preview-pdf-name');
        var previewFilename = document.getElementById('comprobante-preview-filename');
        var defaultBlock = uploadZone.querySelector('.upload-zone-default');
        if (comprobantePreviewUrl) {
          URL.revokeObjectURL(comprobantePreviewUrl);
          comprobantePreviewUrl = null;
        }
        var file = comprobanteInput.files && comprobanteInput.files[0];
        if (!file) {
          preview.classList.remove('visible');
          previewImg.style.display = 'none';
          previewPdf.style.display = 'none';
          previewFilename.textContent = '';
          if (defaultBlock) defaultBlock.style.display = '';
          uploadZone.classList.remove('has-file');
          return;
        }
        uploadZone.classList.add('has-file');
        if (defaultBlock) defaultBlock.style.display = 'none';
        preview.classList.add('visible');
        previewFilename.textContent = file.name + ' (' + (file.size / 1024).toFixed(1) + ' KB)';
        if (file.type.indexOf('image/') === 0) {
          comprobantePreviewUrl = URL.createObjectURL(file);
          previewImg.src = comprobantePreviewUrl;
          previewImg.style.display = 'block';
          previewPdf.style.display = 'none';
        } else {
          previewImg.style.display = 'none';
          previewPdf.style.display = 'flex';
          previewPdfName.textContent = file.name;
        }
      }

      document.getElementById('comprobante-quitar').addEventListener('click', function (e) {
        e.preventDefault();
        e.stopPropagation();
        comprobanteInput.value = '';
        updateComprobantePreview();
      });
      uploadZone.addEventListener('click', function (e) {
        if (!e.target.closest('.comprobante-preview-quitar')) comprobanteInput.click();
      });
      uploadZone.addEventListener('keydown', function (e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          if (!e.target.closest('.comprobante-preview-quitar')) comprobanteInput.click();
        }
      });
      comprobanteInput.addEventListener('change', function () {
        var file = this.files[0];
        if (file && file.size > MAX_FILE_MB * 1024 * 1024) {
          alert('El archivo no debe superar ' + MAX_FILE_MB + ' MB.');
          this.value = '';
        }
        updateComprobantePreview();
      });
      uploadZone.addEventListener('dragover', function (e) { e.preventDefault(); uploadZone.style.borderColor = '#1a4d6d'; });
      uploadZone.addEventListener('dragleave', function () { uploadZone.style.borderColor = ''; });
      uploadZone.addEventListener('drop', function (e) {
        e.preventDefault();
        uploadZone.style.borderColor = '';
        if (e.dataTransfer.files.length) {
          comprobanteInput.files = e.dataTransfer.files;
          if (comprobanteInput.files[0].size > MAX_FILE_MB * 1024 * 1024) {
            alert('El archivo no debe superar ' + MAX_FILE_MB + ' MB.');
            comprobanteInput.value = '';
          }
          updateComprobantePreview();
        }
      });

      var requiredFields = [
        { id: 'nombre', wrap: 'wrap-nombre', err: 'err-nombre' },
        { id: 'email', wrap: 'wrap-email', err: 'err-email' },
        { id: 'telefono', wrap: 'wrap-telefono', err: 'err-telefono' },
        { id: 'escuela', wrap: 'wrap-escuela', err: 'err-escuela' },
        { id: 'talla', wrap: 'wrap-talla', err: 'err-talla' }
      ];

      function clearErrors() {
        requiredFields.forEach(function (f) {
          document.getElementById(f.wrap).classList.remove('error');
          document.getElementById(f.err).textContent = '';
        });
        document.getElementById('wrap-tipo-pago').classList.remove('error');
        document.getElementById('err-tipo-pago').textContent = '';
        document.getElementById('wrap-password').classList.remove('error');
        document.getElementById('err-password').textContent = '';
        var vm = document.getElementById('validacion-mensaje');
        if (vm) { vm.textContent = ''; vm.className = 'validacion-mensaje'; }
        document.getElementById('wrap-comprobante').classList.remove('error');
        var ec = document.getElementById('err-comprobante');
        if (ec) ec.textContent = '';
      }

      function setError(wrapId, errId, msg) {
        document.getElementById(wrapId).classList.add('error');
        document.getElementById(errId).textContent = msg;
      }

      function validate() {
        clearErrors();
        var tipoPago = tipoPagoInput.value.trim();
        var valid = true;
        if (!tipoPago) {
          setError('wrap-tipo-pago', 'err-tipo-pago', 'Selecciona el tipo de pago.');
          valid = false;
        }
        requiredFields.forEach(function (f) {
          var el = document.getElementById(f.id);
          if (!el.value.trim()) {
            document.getElementById(f.wrap).classList.add('error');
            document.getElementById(f.err).textContent = 'Este campo es obligatorio.';
            valid = false;
          }
        });
        if (tipoPago === 'fisico') {
          var pass = document.getElementById('password-vendedor').value;
          if (!pass) {
            setError('wrap-password', 'err-password', 'Ingresa la contraseña del vendedor.');
            valid = false;
          } else if (pass !== PASSWORD_CORRECTA) {
            setError('wrap-password', 'err-password', 'La contraseña es incorrecta.');
            valid = false;
          }
        } else if (tipoPago === 'transferencia') {
          if (!comprobanteInput.files || !comprobanteInput.files.length) {
            setError('wrap-comprobante', 'err-comprobante', 'Debes subir el comprobante.');
            valid = false;
          }
        }
        return valid;
      }

      function buildPayload(callback) {
        var payload = {
          fecha: new Date().toISOString(),
          nombre: document.getElementById('nombre').value.trim(),
          email: document.getElementById('email').value.trim(),
          telefono: document.getElementById('telefono').value.trim(),
          escuela: document.getElementById('escuela').value.trim(),
          talla: document.getElementById('talla').value,
          tipo_pago: tipoPagoInput.value,
          password_vendedor: document.getElementById('password-vendedor').value || '',
          comprobante_nombre: '',
          comprobante_base64: '',
          comprobante_tipo: ''
        };
        var file = comprobanteInput.files && comprobanteInput.files[0];
        if (file) {
          payload.comprobante_nombre = file.name;
          payload.comprobante_tipo = file.type || 'application/octet-stream';
          if (file.size <= MAX_FILE_MB_ENVIO * 1024 * 1024) {
            var reader = new FileReader();
            reader.onload = function () {
              var dataUrl = reader.result;
              payload.comprobante_base64 = dataUrl.indexOf('base64,') >= 0 ? dataUrl.split('base64,')[1] : dataUrl;
              callback(payload);
            };
            reader.readAsDataURL(file);
          } else {
            callback(payload);
          }
        } else {
          callback(payload);
        }
      }

      function enviarConFetch(payload, btnEnviar, textoOriginal) {
        fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        }).then(function () {
          btnEnviar.disabled = false;
          btnEnviar.textContent = textoOriginal;
          showPage(pageThanks);
        }).catch(function (err) {
          btnEnviar.disabled = false;
          btnEnviar.textContent = textoOriginal;
          alert('No se pudo enviar. Revisa tu conexión o intenta de nuevo.');
          console.error(err);
        });
      }

      form.addEventListener('submit', function (e) {
        e.preventDefault();
        if (!validate()) {
          var firstError = document.querySelector('.field.error');
          if (firstError) firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
          return;
        }
        var btnEnviar = document.getElementById('btn-enviar');
        var textoOriginal = btnEnviar.textContent;
        btnEnviar.disabled = true;
        btnEnviar.textContent = 'Enviando…';

        buildPayload(function (payload) {
          var useGoogleScript = typeof google !== 'undefined' && google.script && google.script.run;

          if (useGoogleScript) {
            google.script.run
              .withSuccessHandler(function (res) {
                btnEnviar.disabled = false;
                btnEnviar.textContent = textoOriginal;
                if (res && res.success) {
                  showPage(pageThanks);
                } else {
                  alert(res && res.message ? res.message : 'Error al registrar.');
                }
              })
              .withFailureHandler(function (err) {
                btnEnviar.disabled = false;
                btnEnviar.textContent = textoOriginal;
                alert('Error: ' + (err && err.message ? err.message : String(err)));
              })
              .procesarCompraDesdeFormulario(payload);
          } else if (GOOGLE_SCRIPT_URL) {
            enviarConFetch(payload, btnEnviar, textoOriginal);
          } else {
            btnEnviar.disabled = false;
            btnEnviar.textContent = textoOriginal;
            alert('Configura la URL de la Web App (GOOGLE_SCRIPT_URL) en el código.');
          }
        });
      });
    })();
  </script>
</body>
</html>











